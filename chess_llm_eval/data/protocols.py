from typing import Any, Protocol

from chess_llm_eval.data.models import AgentData, AgentRanking, Game, MoveRecord, Puzzle


class GameRepository(Protocol):
    """Protocol for data persistence."""

    # Puzzle Management
    def get_puzzles(self, limit: int | None = None) -> list[Puzzle]: ...
    def get_puzzle(self, puzzle_id: str) -> Puzzle | None: ...
    def get_uncompleted_puzzles(
        self, agent_name: str, limit: int | None = None
    ) -> list[Puzzle]: ...
    def save_puzzles(self, puzzles: list[Puzzle]) -> None: ...

    # Agent Management
    def get_agent(self, name: str) -> AgentData | None: ...
    def save_agent(self, agent: AgentData) -> None: ...
    def get_all_agents(self) -> list[AgentData]: ...

    # Game Management
    def create_game(self, puzzle_id: str, agent_name: str) -> int: ...
    def update_game_result(self, game_id: int, failed: bool) -> None: ...
    def save_move(self, game_id: int, move: MoveRecord) -> None: ...

    # Benchmarks & Metrics
    def save_benchmark(self, game_id: int, rating: float, rd: float, volatility: float) -> None: ...
    def get_last_benchmark(self, agent_name: str) -> tuple[float, float, float] | None: ...
    def get_leaderboard(self) -> list[AgentRanking]: ...
    def get_game(self, game_id: int) -> Game | None: ...
    def get_agent_games(self, agent_name: str) -> list[Game]: ...

    # Reporting / Analysis (Returning DataFrames or dicts)
    def get_benchmark_data(self) -> Any: ...
    def get_puzzle_outcome_data(self) -> Any: ...
    def get_puzzle_outcomes_by_agent_data(self) -> Any: ...
    def get_illegal_moves_data(self) -> Any: ...
    def get_token_usage_per_puzzle_data(self) -> Any: ...
    def get_final_ratings_data(self) -> Any: ...
    def get_weighted_puzzle_rating(self) -> tuple[float | None, float | None]: ...
